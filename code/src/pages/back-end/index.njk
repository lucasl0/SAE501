{% extends "layouts/back-end/base.njk" %}
{% import "components/back-end/list-actions.njk" as list_actions %}
{% import "pages/back-end/saes/table.njk" as saes with context %}
{% block main %}
    <div class="bg-white rounded-2xl mb-10 shadow-md pb-6">
        <header class="mb-1 p-6 gap-2 lg:gap-0 flex justify-between lg:flex-row flex-col">
            <div>
                <h2 class="text-4xl">
                    Liste articles
                </h2>
                <p class="text-sm">{{ list_articles.count }} éléments au total</p>
            </div>
            <a href="{{ admin_url ~ "/articles" }}" class="inline-flex gap-1 w-full sm:w-fit text-md text-white rounded-2xl items-center text-sm py-2 px-4 bg-blue-700 hocus:bg-blue-950 h-fit justify-center">
                <svg
                    aria-hidden="true"
                    focusable="false"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6">
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75
                            0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375
                            0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"/>
                </svg>
                Voir tout
            </a>
        </header>
        <table class="w-full bg-white rounded-lg overflow-hidden border-collapse">
            <thead>
                <tr class="text-slate-800">
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Titre</th>
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Contenu</th>
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Auteur</th>
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">
                        Dernière mise à jour
                    </th>
                    <th class="px-6 py-3 border-solid border-slate-200 border-b"></th>
                </tr>
            </thead>
            <tbody>
                {% for item in list_articles.data %}
                    <tr class="hover:bg-neutral-50 even:bg-blue-50">
                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6" data-label="Titre">{{ item.title }}</td>
                        <td
                            class="py-4 px-6 bg-transparent border-solid border-slate-200 border-b shadow-transparent  @2xl/main:max-w-[300px]"
                            data-label="Contenu">
                            <p class="line-clamp-2 md:line-clamp-1" title="{{ item.content }}">{{ item.content }}</p>
                        </td>
                        <td class="bg-transparent border-solid border-slate-200 border-b p-6" data-label="Auteur">
                            {% set author = item.author.firstname ~ ' ' ~ item.author.lastname %}
                            {% if item.author.firstname %}
                                <a href="" class="text-blue-700 hover:text-blue-900">{{ author }}</a>
                            {% else %}
                                La rédaction
                            {% endif %}
                        </td>
                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6" data-label="Dernière mise à jour">
                            <time datetime="{{ item.updated_at }}">{{ item.updated_at|date("dd/LL/yyyy à HH:mm") }}</time>
                        </td>
                        <td class="py-4 px-6 bg-transparent border-solid border-slate-200 border-b-2 @-3xl/main:border-b! shadow-transparent
                                lg:text-right align-middle">
                            <div class="inline-flex gap-6 w-full justify-around">
                                {{ list_actions.edit(admin_url ~ '/articles/' ~ item._id) }}
                                {{ list_actions.delete(base_url ~ "/api/articles/" ~ item._id, item.title) }}
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="5" class="text-center bg-transparent border-solid border-slate-200 border-b py-4 px-6">Pas de contenu pour
                            le moment</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="bg-white rounded-2xl mb-10 shadow-md pb-6">
        <header class="mb-1 p-6 gap-2 lg:gap-0 flex justify-between lg:flex-row flex-col">
            <div>
                <h2 class="text-4xl">
                    Liste SAEs
                </h2>
                <p class="text-sm">{{ list_saes.count }} éléments au total -
                    <span class="font-bold">Seuls les 9 derniers éléments sont affichés sur le site</span>
                </p>
            </div>
            <a href="{{ admin_url ~ "/saes" }}" class="inline-flex gap-1 w-full sm:w-fit text-md text-white rounded-2xl items-center text-sm py-2 px-4 bg-blue-700 hocus:bg-blue-950 h-fit justify-center">
                <svg
                    aria-hidden="true"
                    focusable="false"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6">
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75
                            0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375
                            0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"/>
                </svg>
                Voir tout
            </a>
        </header>
        {{ saes.table(list_saes) }}
    </div>
    <div class="bg-white rounded-2xl mb-10 shadow-md pb-6">
        <header class="mb-1 p-6 gap-2 lg:gap-0 flex justify-between lg:flex-row flex-col">
            <div>
                <h2 class="text-4xl">Liste messages</h2>
                <p class="text-sm">{{ list_messages.count }} éléments au total</p>
            </div>
            <a href="{{ admin_url ~ "/messages" }}" class="inline-flex gap-1 w-full sm:w-fit text-md text-white rounded-2xl items-center text-sm py-2 px-4 bg-blue-700 hocus:bg-blue-950 h-fit justify-center">
                <svg
                    aria-hidden="true"
                    focusable="false"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6">
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75
                            0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375
                            0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"/>
                </svg>
                Voir tout
            </a>
        </header>
        <table class="w-full bg-white rounded-lg overflow-hidden border-collapse">
            <thead>
                <tr class="text-slate-800">
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Prénom</th>
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Nom</th>
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Email</th>
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Message</th>
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Statut</th>
                    <th class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Date</th>
                    <th class="px-6 py-3 border-solid border-slate-200 border-b"></th>
                </tr>
            </thead>
            <tbody>
                {% for message in list_messages.data %}
                    <tr class="hover:bg-neutral-50 even:bg-blue-50">
                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6">
                            <a href="{{ admin_url }}/messages/{{ message._id }}" class="text-blue-700 hover:text-blue-900">
                                {{ message.firstname }}
                            </a>
                        </td>
                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6">
                            {{ message.lastname }}
                        </td>
                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6">
                            {{ message.email }}
                        </td>
                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6 @2xl/main:max-w-[300px]">
                            <p class="line-clamp-2 md:line-clamp-1" title="{{ message.content }}">{{ message.content }}</p>
                        </td>
                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6">
                            {% if message.identity == "etudiant" %}
                                Étudiant(e)
                            {% elif message.identity == "parent" %}
                                Parent
                            {% elif message.identity == "autre" %}
                                Autre
                            {% else %}
                                Non précisé
                            {% endif %}
                        </td>
                        <td
                            class="bg-transparent border-solid border-slate-200 border-b py-4 px-6">
                            {# ✅ Version snake_case comme tes articles #}
                            {% if message.created_at %}
                                <time datetime="{{ message.created_at }}">{{ message.created_at | date("dd/LL/yyyy à HH:mm") }}</time>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td class="py-4 px-6 bg-transparent border-solid border-slate-200 border-b lg:text-right align-middle">
                            <a href="{{ admin_url }}/messages/{{ message._id }}" class="text-blue-700 hover:text-blue-900">
                                Voir
                            </a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="7" class="text-center bg-transparent border-solid border-slate-200 border-b py-4 px-6">
                            Pas de messages pour le moment
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}