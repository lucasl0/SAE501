{% extends "layouts/back-end/base.njk" %}
{% block title %}Liste des messages{% endblock %}
{% set active_menu_item = "messages" %}
{% import "components/back-end/pagination.njk" as pagination with context %}
{% block main %}
    <div class="bg-white rounded-2xl shadow-md pb-6">
        <header class="mb-1 p-6 flex justify-between gap-2 lg:flex-row flex-col">
            <div>
                {% include "components/back-end/breadcrumb.njk" %}
                <h2 class="text-4xl">Liste des Messages</h2>
                <p class="text-sm">{{ list_messages.count }} éléments au total</p>
            </div>
        </header>
        {% if list_errors %}
            <div class="px-6">
                <p class="rounded-lg p-3 bg-red-100 text-red-800 border border-red-700 mb-3">
                    {{ list_errors[0] }}
                </p>
            </div>
        {% endif %}
        <table class="w-full bg-white border-collapse">
            <thead>
                <tr class="text-slate-800">
                    <th class="font-bold px-6 py-3 text-left border-b border-slate-200">Prénom</th>
                    <th class="font-bold px-6 py-3 text-left border-b border-slate-200">Nom</th>
                    <th class="font-bold px-6 py-3 text-left border-b border-slate-200">Email</th>
                    <th class="font-bold px-6 py-3 text-left border-b border-slate-200">Message</th>
                    <th class="font-bold px-6 py-3 text-left border-b border-slate-200">Statut</th>
                    <th class="font-bold px-6 py-3 text-left border-b border-slate-200">Date</th>
                    <th class="px-6 py-3 border-b border-slate-200"></th>
                </tr>
            </thead>
            <tbody>
                {% for message in list_messages.data %}
                    <tr class="hover:bg-neutral-50 even:bg-blue-50">
                        <td class="py-4 px-6 border-b border-slate-200">
                            <a href="{{ admin_url }}/messages/{{ message._id }}" class="text-blue-700 hover:text-blue-900">
                                {{ message.firstname }}
                            </a>
                        </td>
                        <td class="py-4 px-6 border-b border-slate-200">{{ message.lastname }}</td>
                        <td class="py-4 px-6 border-b border-slate-200">{{ message.email }}</td>
                        <td class="py-4 px-6 border-b border-slate-200">
                            <p class="line-clamp-2" title="{{ message.content }}">{{ message.content }}</p>
                        </td>
                        <td class="py-4 px-6 border-b border-slate-200">
                            {% if message.identity == "etudiant" %}
                                Étudiant(e)
                            {% elif message.identity == "parent" %}
                                Parent
                            {% elif message.identity == "autre" %}
                                Autre
                            {% else %}
                                Non précisé
                            {% endif %}
                        </td>
                        <td class="py-4 px-6 border-b border-slate-200">
                            {% if message.createdAt %}
                                {{ message.createdAt | date("dd/LL/yyyy HH:mm") }}
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td class="py-4 px-6 border-b border-slate-200 text-right">
                            <a href="{{ admin_url }}/messages/{{ message._id }}" class="text-blue-700 hover:text-blue-900">Voir</a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="7" class="text-center py-4 px-6 border-b border-slate-200">
                            Pas de messages pour le moment
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <footer class="flex justify-between px-4 flex-col @3xl/main:flex-row relative items-center">
            {{ pagination.item(list_messages) }}
        </footer>
    </div>
{% endblock %}