{% extends "layouts/back-end/base.njk" %}
{% set active_menu_item = "auteurs" %}

{% import "components/back-end/pagination.njk" as pagination with context %}
{% import "components/back-end/list-actions.njk" as list_actions %}

{% block main %}
    <div class="bg-white rounded-2xl shadow-md pb-6">
        <header class="mb-1 p-6 gap-2 @3xl/main:gap-0 flex justify-between @3xl/main:flex-row flex-col">
            <div>
                {% include "components/back-end/breadcrumb.njk" %}
                <h2 class="text-4xl">Liste auteurs</h2>
                <p class="text-sm">{{ list_authors.count }} éléments au total</p>
            </div>

            <div class="flex gap-3 flex-col @xl:flex-row">
                <a href="{{ admin_url ~ "/auteurs/add" }}" class="inline-flex gap-1 w-full sm:w-fit text-md text-white rounded-2xl items-center text-sm py-2 px-4 bg-blue-700 hocus:bg-blue-950 h-fit justify-center">
                    <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/>
                    </svg>
                    Ajouter un nouvel auteur
                </a>
            </div>
        </header>

        <div class="px-6">
            {% for item in list_errors %}
                <p class="rounded-lg p-3 bg-red-100 text-red-800 border-solid border-x border-y border-red-700 mb-3">{{ item | safe }}</p>
            {% endfor %}
        </div>

        <table class="w-full bg-white border-collapse">
            <thead>
                <tr class="text-slate-800">
                    <th scope="col" class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b min-w-52">Nom</th>
                    <th scope="col" class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Email</th>
                    <th scope="col" class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Bio</th>
                    <th scope="col" class="font-bold px-6 py-3 text-left border-solid border-slate-200 border-b">Articles</th>
                    <th scope="col" class="px-6 py-3 border-solid border-slate-200 border-b"></th>
                </tr>
            </thead>

            <tbody>
                {% for item in list_authors.data %}
                    <tr class="hover:bg-neutral-50 even:bg-blue-50">
                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6 min-w-52" data-label="Nom">
                            {{ item.firstname }} {{ item.lastname }}
                        </td>

                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6" data-label="Email">
                            {{ item.email }}
                        </td>

                        <td class="py-4 px-6 bg-transparent border-solid border-slate-200 border-b shadow-transparent" data-label="Bio">
                            {% if item.bio %}
                                <p class="line-clamp-2" title="{{ item.bio }}">{{ item.bio }}</p>
                            {% else %}
                                <span class="text-slate-500">—</span>
                            {% endif %}
                        </td>

                        <td class="bg-transparent border-solid border-slate-200 border-b py-4 px-6" data-label="Articles">
                            {{ item.nb_articles }}
                        </td>

                        <td class="py-4 px-6 bg-transparent border-solid border-slate-200 border-b-2 @-3xl/main:border-b! shadow-transparent lg:text-right align-middle">
                            <div class="inline-flex gap-6 w-full justify-around">
                                {{ list_actions.edit(admin_url ~ '/auteurs/' ~ item._id) }}
                                {{ list_actions.delete(base_url ~ "/api/authors/" ~ item._id, (item.firstname ~ ' ' ~ item.lastname)|trim) }}
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="5" class="text-center bg-transparent border-solid border-slate-200 border-b py-4 px-6">
                            Pas de contenu pour le moment
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <footer class="flex justify-between px-4 flex-col @3xl/main:flex-row relative items-center">
            {{ pagination.item(list_authors) }}
        </footer>
    </div>
{% endblock %}
